---
layout: post
title: Git-Repositorien auf einen anderen Git-Server umziehen
author: Christian Glahn
date: 2021-04-13
tags: 
- projektmanagement
- praxis
- git
- github
- tricks
---

[Git](https://git-scm.com/) ist heute nicht mehr aus dem Projektmanagement von IT- und Data-Science-Projekten wegzudenken. Es ist ein extrem leistungsfähiges Werkzeug für die Versionsverwaltung von komplexen Projekten. Manchmal müssen wir die Projekte reorganisieren und auf einen anderen Server migrieren. Zum Beispiel weil wir ein Projekt von [GitHub.com](https://github.com) auf unsere [GitHub Enterprise Instanz](https://github.zhaw.ch) verschieben müssen oder ein Projekt auf [GitLab](https://gitlab.com) veröffentlichen möchten. In solchen Fällen wollen wir die Versionsgeschichte und die Projektkonfigurationen beibehalten und nicht unsere bisherige Arbeit löschen. In diesem Beitrag beschreibe ich wie man ein Git-Repository leicht von einem Repository-Server auf einen anderen umzieht. 

Git ist ein freies, verteiltes Versionsmanagementsystem, das heute praktisch der Industriestandard für IT-Projekte ist. Git wird von vielen bekannten Open-Source- und kommerziellen Software- und Data-Science-Projekten verwendet. Das Verteilt in "verteiltes Versionsmanagement" bedeutet, dass es keine zentralen Server geben muss, auf dem alle Daten zusammenlaufen. Vielmehr hat jedes Teammitglied ein eigenes vollständiges Original der Projektgeschichte. Dadurch ist eine grösstmögliche Sicherheit und Flexibilität bei der Entwicklung von digitalen Lösungen sichergestellt. Das bedeutet auch, dass ein Projekt nicht an eine Plattform wie z.B. GitHub oder GitLab gebunden ist. Die Entscheidung wo und wie wir unseren Code und unsere Daten ablegen wollen liegt also bei uns. Weil diese Entscheidung bei uns liegt, können wir uns auch entscheiden, Code auf mehreren Plattformen gleichzeitig abzulegen und so anbieterunabhängige Backups zu erstellen.

### Grundbegriffe

Ich gehe davon aus, dass schon erste Schritte mit Git gemacht wurden, daher werde ich hier nicht auf Einzelheiten zum Projekt-Management eingehen. Für das Umziehen sind nur die folgenden Begriffe und Befehle wichtig. 

- Repository - Ein Repository bildet die Code- bzw. Datenbasis eines Projekts *zusammen* mit der Geschichte aller Änderungen ab. 
- Git-Server - Ein Server auf und von dem wir Git-Repositorien laden können. Sie bilden das Herzstück für die Teamzusammenarbeit.
- Klon (engl. *clone*) - eine vollständige und eigenständige Fassung des gleichen Git-Repositories.
- Remote - Die URL eines bekannten anderen Klons des gleichen Git-Repositories.
- `git fetch` - Befehl zum Holen der Änderungen aus anderen Git-Repositorien.
- `git pull` - Befehl, um Änderung eines anderen Git-Repositories in den eigenen Klon des Git-Repositories zu holen.
- `git push` - Befehl, um Änderungen des eigenen Git-Repositories an einen anderen Klon zu schieben.

### Git-Remotes verwalten

Git funktioniert deshalb so flexibel, weil jeder Klon eines Repositories wie ein eigenständiges Orginal funktioniert. Damit wir zusammenarbeiten können müssen wir die Klone eines Git-Repositories noch verbinden. Das geschieht in der Regel über die Herkunft eines Klons, dem sog. `origin`. Diese Herkunft ist in unseren Git-Repositorien als `remote` abgelegt. Das können wir mit `git remote` und `git remote get-url origin` abfragen. 

![git remote](/assets/images/post_20210413/git_remote.png)

Ein Git-Repository kann aber auch mehr als ein Remote-Repository haben, damit wir Verbindungen zu mehreren Git-Servern halten können. Damit wir die Verbindungen auseinander halten können, sind die Verbindungen benannt. Diese Namen können wir uns ausdenken. Weil wir unser Repository umziehen wollen, ist ein guter Name `neworigin`.

Wir erstellen eine neue Verbindung zu einem Git-Server (in unserem Fall der ZHAW GitHub Instanz) mit dem folgenden Kommando:

```zsh
git remote add neworigin https://github.zhaw.ch/dxiai/moodle-autopilot.git
```

Das spannende an diesem Befehl ist, dass die das entfernte Repository noch nicht existieren muss. Wichtig ist nur, dass wir ein neues Repository in dem angegebenen Bereich (`dxiai`) anlegen dürfen. 

Weil es so schön ist, lege ich gleich noch ein Remote auf meinen privaten Git-Server an: 

```zsh
git remote add homeoffice https://git.0xff.li/phish108/moodle-autopilot.git
```

Das Ergebnis können wir wieder mit `git remote` abfragen. 

![git multiple remotes](/assets/images/post_20210413/git_multiremote.png)

Unser Repository hat jetzt 3 Remotes. 

Bevor wir weitermachen, sichern wir uns noch ab, dass wir auch alle Änderungen vom originalen Server geholt haben. Das erreichen wir mit den folgenden Kommandos:

```zsh
git fetch origin
git pull origin master
```

### Ein Git-Repository auf einem Git-Server bereitstellen

Mit unseren Remotes sind wir schon fast fertig mit unserem Umzug. Jetzt muss nur noch das lokale Repository auf den entfernten Git-Server geschoben werden. Ein einfaches `git push` reicht hier nicht. Wir müssen zusätzlich noch die Option `--all` anfügen, damit git das gesamte Repository auf den Server schiebt und wir keine Daten verlieren. Ausserdem müssen wir das Ziel unseres Verschiebens angeben, damit Git weiss, wohin die Daten sollen.

![git push --all homeoffice](/assets/images/post_20210413/git_push_newremote.png)

Diesen Schritt wiederholen wir für alle unseren neuen Remotes. 

### GitHub ist nicht (nur) Git!

Beim Umziehen von einem Projekt auf GitHub oder auf einen GitHub-Enterprise-Server merken wir, dass GitHub nicht das gleiche wie Git ist, denn wir können nicht einfach mit `git push --all` ein Git-Repository zu GitHub schieben. Stattdessen erhalten wir einen Fehler.

![git push --all homeoffice](/assets/images/post_20210413/git_push_github.png)

Der Fehler wird dadurch verursacht, dass GitHub zwingend ein bestehendes Projekt auf dem Server benötigt, dass unser Repository aufnimmt. *Bevor* wir also ein Git-Repository zu GitHub oder zu einem GitHub-Enterprise-Server umziehen können, müssen wir ein (leeres) Projekt erstellen. 

Mit der GitHub CLI geht das ganz einfach. Der Befehl folgt der folgenden Syntax.

```zsh
gh repo create [org/]repository-name
```

Bevor wir also das Projekt `moodle-autopilot` auf unser ZHAW-GitHub-Enterprise umziehen können, müssen wir das Repository wie folgt erstellen: 

```zsh
GH_HOST=github.zhaw.ch gh repo create dxiai/moodle-autopilot
```

![GitHub CLI Animation](/assets/images/post_20210413/gh_cli_repo_create.gif)

Nicht alle haben die GitHub CLI installiert. Für diese gibt es auch die Möglichkeit ein Projekt ganz normal über die Web-Oberfläche zu erstellen.

Dazu geht man auf die Seite mit den eigenen Repositories bzw. den Repositories der eigenen Organisation. 

Dort wählt man "New".

![GH Projekt erstellen](/assets/images/post_20210413/gh_newproject.png)

Daraufhin erscheint ein Formular für die Basisinformationen des Projekts. Hier müssen wir nur den Namen eingeben. Die Auswahlboxen im unteren Teil des Formulars müssen wir unbedingt ***leer*** lassen!

![GH Projekt Form](/assets/images/post_20210413/gh_projectoptions.png).

Diesen Schritt schliessen wir ab, indem wir auf `Create repository` klicken. 

Erst jetzt dürfen wir unser lokales Repository mit `git push --all neworigin` auf den Server schieben. 

### Umzug beenden und die alte Verbindung kappen

Nachdem unser Repository auf dem neunen Server geschoben wurde, können wir die alte Verbindung kappen und die neue Verbindung als `origin` setzen. 

Das erreichen wir mit den folgenden Kommandos: 

```zsh
git remote remove origin
git remote rename neworigin origin
```

Jetzt ist mein lokales Repository mit einem neuen Git-Server verbunden und alle Änderungen werden von jetzt ab auf dem internen Server landen. 
Natürlich kann ich immer noch Sicherungen aus meinem Homeoffice auf meinem eigenen Server anlegen. Das ist sehr praktisch. 

Ich habe das alter Git-Repository auf GitHub nicht gelöscht. D.h. meine alten Änderungen sind dort immer noch verfügbar. Jede neue Anpassung des Codes wird jedoch nicht mehr in diese Repository einfliessen. Wenn ich mir ganz sicher wäre, könnte ich jetzt das alte Repository auf GitHub löschen. 
