--- 
layout: post
title: R-Vektoren ohne Schleifen
date: 2023-05-18
author: Christian Glahn
tags: 
- funktionale Programmierung
- R
- Map-Reduce
- Style
- No Loops
---

Bei [R-Bloggers](https://www.r-bloggers.com/) bin ich heute auf den [Beitrag von Steven Sanderson II](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-17/index.html) gestossen, welcher die Funktion `strftime()` erklÃ¤rt. Ich habe den Artikel eigentlich nur gelesen, um festzustellen, was die R-Community gerade so beschÃ¤ftigt. Weil der gezeigte Code auf mich geradezu antiquiert wirkte, musste ich das Datum des Beitrags kontrollieren und habe festgestellt, dass der Beitrag erst einen Tag alt war ðŸ˜±.

Hier ist der anstÃ¶ssige Code aus dem Originalbeitrag: 

```R
RightNow <- Sys.time()

# all of the modifiers
for (formatter in sort(c(letters, LETTERS))) {
  modifier <- paste0("%", formatter)
  print(
    paste0(
      modifier, 
      " used on: ",
      RightNow,
      " will give: ",
      strftime(RightNow, modifier)
    )
  )
}
```

Das verwendete Programmierparadigma ist **imperativ**, was nicht mehr ganz zu modernem R passt. Ich habe mich gefragt, wie aufwÃ¤ndig eine LÃ¶sung im **funktionalen** Programmierparadigma ausfallen wÃ¼rde, um den sprachlichen Eigenschaften von modernen R-Versionen gerechtzuwerden. Weil der Code im Originalbeitrag ohne zusÃ¤tzliche Bibliotheken auskommt, musste die funktionale LÃ¶sung ebenfalls in Base R umgesetzt werden.

Hier ist meine LÃ¶sung: 

```R
c(letters, LETTERS) |> 
    sort() |>
    (\(formatter) paste0("%", formatter))() |> 
    (\(modifier, RightNow) paste0(
        modifier, 
        " used on: ", 
        RightNow, 
        " will give: ", 
        strftime(RightNow, modifier)
    ))(Sys.time())
```

Diese LÃ¶sung kommt ohne globale Variablen und Schleifen aus und ist ausserdem kompakter als die ursprÃ¼ngliche Variante. 

Meine LÃ¶sung verwendet den *native Pipe*-Operator (`|>`) sowie die Kurzform fÃ¼r anonyme Funktionsdeklarationen (`\()`). Beide Operatoren sind seit zwei Jahren bzw. seit [Version 4.1.0 Teil von Base R](https://cran.r-project.org/bin/windows/base/old/4.1.0/NEWS.R-4.1.0.html) und gehÃ¶ren somit zum sprachlichen Kern von R.

Der Anfang des Codes ist bis zum Aufruf von `sort()` identisch mit der Logik des ursprÃ¼nglichen Codes: Das Ergebnis ist ein Vektor mit der sortierten Kombination der beiden Basis-Vektoren `letters` und `LETTERS`. Ab diesem Punkt spare ich mir die `for`-Schleife und nutze aus, dass R-Funktionen immer fÃ¼r alle Elemente eines Vektors als implizite [Map-Funktion](https://de.wikipedia.org/wiki/MapReduce) ausgefÃ¼hrt werden.

Die Code-Zeile `(\(formatter) paste0("%", formatter))()` erstellt eine anonyme Hilfsfunktion, welche vor jeden Ã¼bergebenen Parameterwert ein Prozentzeichen einfÃ¼gt, und fÃ¼hrt diese Funktion sofort aus. Diese Hilfsfunktion wird nur deshalb benÃ¶tigt, weil der Pipe-Operator die Werte ausschliesslich als ersten Parameter an die nachfolgende Funktion Ã¼bergeben kann. Die Funktion `paste0()` kann aber die Ã¼bergebenen Zeichenketten nur in dieser Reihenfolge aneinanderfÃ¼gen. Die Hilfsfunktion lÃ¶st dieses Problem, indem die Funktion den Datenfluss der Pipe aufnimmt und dann fÃ¼r die Funktion `paste0()` korrekt arrangiert. 

Damit die Hilfsfunktion sofort ausgefÃ¼hrt werden kann, muss die Funktionsdeklaration geklammert werden. Dieser Klammer folgen dann die Funktionsparameter. In diesem Fall steht fÃ¼r die Parameterliste nur `()`, weil der einzige Parameter von der Pipe eine Zeile darÃ¼ber weitergereicht und deshalb nicht angegeben wird.

Das letzte Fragment erstellt die Ausgabezeichenkette und ist ebenfalls als anonyme Hilfsfunktion umgesetzt. Diesmal hat die Funktion zwei Parameter, weil fÃ¼r die Ausgabe zwei Werte von Bedeutung sind. Der erste Parameter `modifier` wird von der Pipe befÃ¼llt und erhÃ¤lt den Ergebnisvektor der ersten Hilfsfunktion Ã¼ber die Pipe. Der zweite Parameter `RightNow` nimmt das Ergebnis der Funktion `Sys.time()` auf. Weil diese ParameterÃ¼bergabe nur ***eine*** AusfÃ¼hrung dieser Funktion erfordert, entfÃ¤llt die globale Variable `RightNow` des ursprÃ¼nglichen Codes und die damit verbundenen potenziellen Seiteneffekte. 

Die beiden Hilfsfunktionen haben einen positiven Nebeneffekt: Die Variablennamen der ursprÃ¼nglichen LÃ¶sung bleiben fÃ¼r die Lesbarkeit erhalten.

Weil die Lesbarkeit durch die Kurzform der Funktionsdeklaration und die vielen ZeilenumbrÃ¼che fÃ¼r die Ausgabe leidet, hier noch eine Variante in der funktionalen Langform: 

```R
c(letters, LETTERS) |> 
    sort() |>
    (function (formatter) paste0("%", formatter))() |> 
    (function (modifier, RightNow) paste0(
        modifier, " used on: ", RightNow, " will give: ", strftime(RightNow, modifier)
    ))(Sys.time())
```

Das sieht doch gleich viel besser aus. ðŸ˜Ž

FÃ¼r die Funktionsweise dieser Logik empfielt sich die LektÃ¼re des [Beitrags von Steven Sanderson II](https://www.spsanderson.com/steveondata/posts/rtip-2023-05-17/index.html).

